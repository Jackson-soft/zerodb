
> ZeroDB在CP与AP之间的取舍与思考：
在这个数据是核心资产的今天，分库分表中间件作为整个公司数据服务的入口，数据的安全，正确与一致性一直是放在第一位的，因为交易数据一旦出错，会给商家带来不信任感，业务就很难推广。在系统中，数据一致性的基础是zeroProxy的配置一致性，所谓配置，指的主要是分库分表的配置，如果集群中zeroProxy配置不一致，很容易造成数据路由冲突，在某些情况下，错误的路由数据几乎是不可恢复的。ZeroDB在CP和AP中会更加偏向于CP，如果一旦zeroProxy发现自己与集群不一致，它会立即停止服务，牺牲掉可用性，重启并重新去配置中心拉取数据，以保证集群配置一致性；如果zeroKeeper发现zeroProxy有状态不明确的节点，数据源切换或者集群配置推送这种有可能打破配置一致性的操作都是不可用的。我们常见的另一个CP和AP的讨论是关于ZooKeeper到底适合做服务发现么，当然，ZK当然是一个CP的系统，具有非常严格的一致性，甚至当网络阻隔而影响一致性时，ZK不惜停止对外服务，以不提供可能不一致的数据。但是，服务发现却是一个没有那么严格的系统，如果服务发现节点A里面由于网络原因落下了ip3的提供者，只剩下（ip1,ip2），即便A知道自己落下了，也不应该停止服务，因为对于整个服务RPC而言，可能就是基于A节点的RPC调用只是不去调用ip3，而ip1和ip2的服务提供者还是可以正常工作。CP,AP没有孰优孰劣之分，只是必须根据具体场景去选择。
